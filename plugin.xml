<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.2"?>

<plugin>
<!-- Which program to run at startup -->
<extension point="org.eclipse.ui.startup">
  <startup class="il.org.spartan.plugin.Plugin"/>
</extension>

<!-- Builder, i.e, the system component that keeps generating spartan tips when
the program changes: https://goo.gl/sIqIBC
 -->
<extension 
  name="Spartan tipper" 
  id="spartan.tipper" 
  point="org.eclipse.core.resources.builders"
>
  <!-- the most important part, which Java class to run on changes -->
  <builder hasNature="true"> 
    <run class="il.org.spartan.plugin.Builder"/> 
  </builder>
</extension>

<!-- Preferences page -->
<extension point="org.eclipse.ui.preferencePages">
  <page 
  name="Laconization"
  class="il.org.spartan.plugin.PreferencesPage"
  id="il.org.spartan.plugin.PluginPreferencesPage"
  category="org.eclipse.jdt.ui.preferences.JavaBasePreferencePage">
  </page>
</extension>

<!-- Preferences-->
<extension point="org.eclipse.core.runtime.preferences">
  <scope 
    name="PluginPreferencesPage" 
    class="il.org.spartan.plugin.PreferencesPage"
  />
  <initializer class="il.org.spartan.plugin.PreferencesDefaultValuesInitializer"/>
</extension>

<!-- Daniel Mittleman' application-->
<extension 
  point="org.eclipse.core.runtime.applications" 
  name="Batch spartanization"
  id="il.org.spartan.spartanizer.application"
>
  <application>
  <run class="il.org.spartan.spartanizer.application.Application"/>
  </application>
</extension>

<!-- Matteo Orru's application-->
<extension
  point="org.eclipse.core.runtime.applications"
  name="Metrics collector by Matteo Orru"
 id="il.org.spartan.spartanizer.collectmetricsapp"
>
  <application>
  <run class="il.org.spartan.spartanizer.application.CollectMetricsApp"></run>
  </application>
</extension>

<!-- Marker: for showing the tips of spartanizaton 
https://goo.gl/OI2pBd -->
<extension 
  id="il.org.spartan.tip"
  name="Laconization"
  point="org.eclipse.core.resources.markers" 
>
  <!-- in the future we may want to break this into several kinds, renaming,
       syntactic baggage, ternarization, etc. -->
  <super type="org.eclipse.core.resources.problemmarker"/>
</extension>

<extension point="org.eclipse.ui.editors.annotationTypes">
  <type 
    name="il.org.spartan.tip"
    super="org.eclipse.ui.workbench.texteditor.info"
    markerType="org.eclipse.jdt.core.problem"
    markerSeverity="0"
  />
</extension>

<!-- Marker resolution: This is where the quick fixing menus gets bound to the 
Java class which generates quick fix suggestions. -->
<extension point="org.eclipse.ui.ide.markerResolution">
  <markerResolutionGenerator 
   markerType="il.org.spartan.tip"
   class="il.org.spartan.plugin.QuickFixer"
  />
</extension>

<extension point="org.eclipse.ui.editors.markerAnnotationSpecification">
  <specification
     annotationType="il.org.spartan.tip"
     colorPreferenceKey="il.org.spartan.spartanizationMarker.color"
     colorPreferenceValue="0,0,180"
     contributesToHeader="false"
     includeOnPreferencePage="true"
     label="Tip"
     overviewRulerPreferenceKey="il.org.spartan.plugin.spartanizationMarker.overview"
     overviewRulerPreferenceValue="true"
     presentationLayer="0"
     textPreferenceKey="il.org.spartan.spartanizationMarker.text"
     textPreferenceValue="true"
     textStylePreferenceValue="PROBLEM_UNDERLINE"
     verticalRulerPreferenceKey="il.org.spartan.plugin.spartanizationMarker.ruler"
     verticalRulerPreferenceValue="true">
  </specification>
</extension>

<!-- Nature: trust us, without this mystery, there would be no suggestions 
     shown/generated, manual is a bit vague, but that's the bottom line -->
<extension 
  point = "org.eclipse.core.resources.natures" 
  name = "Spartanizable" 
  id = "il.org.spartan.nature"
>
  <runtime>
    <run class="il.org.spartan.plugin.Nature"/> 
  </runtime>
  <builder id="spartan.tipper"/> 
</extension>

<!-- List of our abstract commands: 
http://help.eclipse.org/neon/index.jsp?topic=%2Forg.eclipse.platform.doc.isv%2Fguide%2Fworkbench_cmd_commands.htm 
-->
<extension point="org.eclipse.ui.commands">
     <command id="il.org.spartan.SpartanizeAll" name="Spartanize entire project"/>
     <command id="il.org.spartan.SpartanizeCurrent" name="Spartanize active window" />
     <command id="il.org.spartan.SuggestionToggle" name="Suggestions on/off">
           <state class="org.eclipse.ui.handlers.RegistryToggleState:true" id="org.eclipse.ui.commands.toggle"/>
    </command>
     <command id="il.org.spartan.RefreshAll" name="Refresh all projects (slow)" />
     <command id="il.org.spartan.SpartanizeableAll" name="Add spartanization nature to all projects" />
</extension>


<!-- Handlers of commands: which class to activate -->
<extension point="org.eclipse.ui.handlers">
   <handler commandId="il.org.spartan.SpartanizeAll" class="il.org.spartan.plugin.LaconizeProject"/>
   <handler commandId="il.org.spartan.SpartanizeCurrent" class="il.org.spartan.plugin.LaconizeCurrent"/>
   <handler commandId="il.org.spartan.SuggestionToggle" class="il.org.spartan.plugin.TipsOnOfToggle"/>
   <handler commandId="il.org.spartan.RefreshAll" class="il.org.spartan.plugin.RefreshAll"/>
   <handler commandId="il.org.spartan.SpartanizeableAll" class="il.org.spartan.plugin.SpartanizeableAll"/>
</extension>

<!-- Menus -->
<extension point="org.eclipse.ui.menus"> 

  <!-- Toolbar button -->
  <menuContribution locationURI="toolbar:org.eclipse.ui.main.toolbar?after=additions">
    <toolbar id="il.org.spartan.plugin.toolbars.spartanToolbar">
       <command 
       tooltip="Fully spartanize compilation unit"
         commandId="il.org.spartan.SpartanizeCurrent" 
         icon="src/main/icons/spartan-warrior.gif" 
         id="il.org.spartan.plugin.toolbars.HelmetButton">
       </command>
    </toolbar>
  </menuContribution>

  <!-- Popup menus 
       Not sure that this is not the one that creates URI exceptions at start. Commented
       out for now // TODO: Ori Roth
  <menuContribution allPopups="true" locationURI="popup:org.eclipse.ui.popup.any?after=additions" >
     <menu id="il.org.spartan.menus.spartanization" label="Laconization" mnemonic="M">
        <command commandId="il.org.spartan.SpartanizeCurrent" style="push"/>       
        <command commandId="il.org.spartan.SpartanizeAll" style="push"/>
        <command commandId="il.org.spartan.SuggestionToggle" style="toggle"/>
        <command commandId="il.org.spartan.RefreshAll" style="push"/> 
        <command commandId="il.org.spartan.SpartanizeableAll" style="push"/> 
         <command commandId="il.org.spartan.SuggestionToggle"
              id="il.org.spartan.menus.Toggle"
              style="toggle"
              mnemonic="S">
        </command>
     </menu>
  </menuContribution>
  -->

  <!-- Top line, main menu -->
<menuContribution locationURI="menu:org.eclipse.ui.main.menu?before=navigate">
   <menu id="org.eclipse.jdt.ui.refactoring.menu" label="Refactor">
      <menu label="Laconiazation">
        <command commandId="il.org.spartan.SpartanizeCurrent" style="push"/>       
        <command commandId="il.org.spartan.SpartanizeAll" style="push"/>
        <command commandId="il.org.spartan.SuggestionToggle" style="toggle"/> 
        <command commandId="il.org.spartan.RefreshAll" style="push"/> 
        <command commandId="il.org.spartan.SpartanizeableAll" style="push"/> 
   </menu>
   </menu>
</menuContribution>
</extension>

<!-- Shortcuts -->
<extension point="org.eclipse.ui.bindings">
	<key sequence="Ctrl+5"
		commandId="il.org.spartan.SpartanizeCurrent"
		schemeId="org.eclipse.ui.defaultAcceleratorConfiguration"/>
</extension>

</plugin>
